---
title: "Investigating Vocational Teachers' Informal Workplace Learning Using Experience Sampling"
author: "Manuel Böhm"
date: '`r Sys.Date()`'
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    toc_depth: 2
    keep_tex: TRUE
  html_document:
    toc: true
    toc_depth: '2'
    df_print: paged
  word_document: default
bibliography:
- _bib/references.bib
- _bib/grateful-refs.bib
csl: _bib/apa.csl
link-citations: true
toc: true
toc-title: Article Outline
header-includes: \pagenumbering{gobble}
numbersections: true
---

\newpage
\pagenumbering{arabic}

# Acknowledgement {.unnumbered}

We would like to express our gratitude to Miss Julia Banschbach for the invaluable work in her masters' thesis. The created  learning outcome framework based on the literature as well as her qualitative data analysis served as a basis for answering the second research question in this paper. 

\newpage

# Abstract {.unnumbered}

...

Keywords: workplace learning, teacher training, informal learning, experience sampling, multilevel modelling

\newpage

# Introduction

According to @rauschUsingDiariesResearch2014, ...

-   teacher shortage and difficult working conditions of teachers

    -   stress, coping are important

    -   learning of teachers has a particular important role

        -   teachers have to prepare their lessons and

        -   furthermore, teachers need to stay up to date

        -   The teaching profession has a particular set of characteristics and job demands. At the same time, teachers are provided with a high degree of freedom or job decision latitude. –\> Karasek: learning hypothesis

    -   vocational schools are under-represented in studies (). while there is research tackling other schools, still very little research on vocational schools.

-   lack of research on teachers at vocational schools ()

    -   experience sampling

Thus, the following research questions will be tackled in this paper:

1.  RQ (Stress, coping and learning across activities, control for age, sex, jobscope + data from the FBS) - MLM

    Which of teachers' daily work activities are perceived as (a) the most stressful and (b) with which of the stressful activities could the teachers cope the best? (c) Which of teachers' daily activities are perceived as the most conducive to learning?

2.  [Desription of the Learning (freetext fields, qualitative analysis)]

3.  RQ (Karasek, control for age, sex, jobscope + data from the FBS) - MLM

    Do stress and coping predict informal learning in teachers' daily work activities, as stated in Karasek's learning hypothesis?

    H: according to Karasek

include a participation effect (control for a bias) H: higher participation -\> bigger pc_learn Can time effects be found in the data? Does continued experience sampling have an effect on perceived informal learning?

# Research on Teachers' Workplace Learning

## Characteristics of the Teaching Profession and Vocational Teachers' Daily Work Activities

### Characteristics

-   High degree of freedom in the profession

-   subject (especially in vocational schools).

    -   --\> high demand to learn

-   Needed: Alternative to Rothland (2013)???

    -   Multiple sources that describe the characteristics

-   teacher stressors and coping (briefly): outline from research on teacher stress

    -   –\> Lazarus & Folkman (for Stress)

### Teachers' Daily Work Activities

-   Overview teachers' work activities (framework from the literature)

## Workplace Learning and Vocational Teachers' Learning Activities

-   formal, non-formal vs. informal WPL (so far from bwpat!!!)
- how do teachers learn?
- include selected frameworks from literature (NK, MA)

In workplace learning, researchers typically differentiate between formal, non-formal and informal learning (e.g., Coombs & Ahmed, 1974; Imants & van Veen, 2010). Formal learning is typically defined as structured learning in pedagogical settings such as university teacher training. In these settings, learning occurs intentionally and is planned (Marsick & Watkins, 2015; UNESCO Institute for Statistics, 2012). Non-formal learning is “institutionalized, intentional and planned” as well (UNESCO Institute for Statistics, 2012, p. 11) but in contrast to formal learning, it is not part of the national qualifications framework but includes training and development in companies (Bilger et al., 2013, p. 20) such as information resources for further teacher training. In contrast, informal learning is unintentional and experiential. It occurs as a by-product of other activities such as working (e.g., Marsick & Watkins, 2015, p. 6; UNESCO Institute for Statistics, 2012, p. 19). This learning is also referred to as implicit learning (Eraut, 2004) or incidental learning (Marsick & Watkins, 2015). Though less conscious, this informal learning is considered as a vital source of teachers’ professional development. Work task characteristics that foster informal workplace learning include newness, complexity, collaboration and so forth (Hoekstra, 2007; Lohman, 2003; Rausch, 2013; Kwakman, 2003) many of which, as discussed above, are also likely to cause stress (Karasek, 1979).

-   Billett?!
-   Karasek
    -   Studies on Karasek
        -   The Job Demand-Control (-Support) Model and psychological well-being: A review of 20 years of empirical research (<https://doi.org/10.1080/026783799296084>)
        -   

1.  Billett and others (which characteristics of the situation and the activity foster learning?!)

2.  Consideration of stress (Karasek, ...)

    use stress as a characteristic of activities to introduce Karasek (and briefly talk about negative consequences: Lazarus & Folkman)

get concrete: Teachers' Learning Activities

## Learning Outomes from Vocational Teachers' Workplace Learning

-   Goal: categorizing learning outcomes that stem from teachers' informal workplace learning
-   For this, existing frameworks from workplace learning literature are analyzed and compared
-   Then, a category framework is developed deductively from existing frameworks and then adjusted inductively from the results from this study.

### Eraut (2004)

8 categories:

-   

-   

### Tynjälä (2013, 3-P model)

### Kyndt et al. (2013)

### Cerasoli et al. (2018)

### Park (2020)

### Smet et al. (2022)

--\> also consider additional frameworks from teacher professional development

## Job Demands and Job Resources in the Teaching Profession

### Job Demands / Stress

### Job Resources / Coping

### The Effect of Job Demands / Stress and Job Resources / Coping on Vocational Teachers' Workplace Learning

# Description of the Longitudinal Study

## Research Design and Sample

This study is part of a research programme (AARL-BS) which was initiated to investigate the relations between working hours, work activities, and work experience, such as learning, stress and coping of teachers at vocational schools. [Data was collected in two studies, an online survey study and an app-based diary study. This allowed for balancing the advantages and disadvantages of the respective methods regarding the estimation of working hours and the measuring of work experience, in particular. Participation was voluntary and all participants provided written informed consent.]{.underline}

### Questionnaire Study

The survey study was conducted from February to November 2022. A sample of 1,146 full-time teachers participated in the survey study, 74.3 % of which held no further management function beyond their teaching duties. The mean age was 46.98 years and 39.1 % of the sample is female. The distribution of the survey sample is representative for vocational teachers in the German federal state of Baden-Wuerttemberg with regard to gender, age composition, level of employment, and administrative district.

In the survey study, data on teachers’ working time, the distribution of the working hours between different tasks, working conditions, job satisfaction, and further constructs were collected. The questionnaire was developed on the basis of a comprehensive literature review (Aprea & Sarochan, 2023) and intensive consultations with representatives of the Association of Vocational School Teachers in Baden-Württemberg (BLV). [See the other papers ...]{.underline}

### Diary Study (go more into detail here, ESM, design)

The diary study took place from mid-March to mid-October 2022, including weekends and vacation periods, excluding four weeks during the summer holiday. A multi-cohort design was chosen to reduce participant burden. Each of the five cohorts held the diary for one week and paused for four weeks. The diary app was implemented using mQuest by the German online service provider Cluetec (Karlsruhe). [Diary entries from 145 full-time teachers were included, 75.2 % of which without a management function. The mean age is 44.99 years and 46.9 % of the sample is female. After intensive data preparation and filtering, the analysis is based on 10.327 activities that were reported in the diary app]{.underline}.

The participants were requested to record all work-related activities by selecting the respective work activity from a given list of activities, indicating start and end time and answering one item each for experienced stress, coping, and learning related to the respective task. [In addition, in a weekly review, the participants were requested to indicate the working hours for each day of the past week.]{.underline} During a cohort’s diary period, three daily notifications reminded the participants to record their work activities.

## Measures and Data Analysis

-   Stress, Coping and Learning across the Daily Work Activities
    -   Stress, coping and learning were all measured using 1 item scales self report
    -   Description of the Developed Task Framework

From bwpat

Afterwards, the perception of stress, coping and learning at the given work activity are evaluated by the participants. (1) Stress, (2) coping and (3) learning are each designed with an 8-point Likert-scale with 0 as the lowest and 7 as the highest value. To avoid influencing entries with a default value, “-1” is set as the default value in these three items and must be changed to proceed. All three questions are depicted with a slider to set the value and a brief explanation: (1) Did you find this work activity stressful? (0 = not at all stressful; 7 = very stressful; -1 = invalid entry); (2) How well were you able to cope with this stress? (0 = not coped well at all; 7 = coped very well; -1 = invalid entry); (3) Did you learn anything new for your job during this work activity? (0 = learned nothing at all; 7 = learned very much; -1 = invalid entry). Based on theoretical assumptions, participants could only evaluate their coping for work activities with a stress-level above 0.

### Learning Outcome Framework (RQ 2)

K. Kompetenzebene

KI. Individuum

Performanzebene

## Data Analysis (still from bwpat)

Descriptive statistics were calculated to address RQ1 to RQ3. Regarding RQ4, a multiple linear regression analysis was conducted to investigate the statistical prediction of job satisfaction based on working hours, management function, stress, coping, and learning. Interaction terms were checked. However, moderators showed no significant effects, so no interactions were included in the final analysis.

```{r maintenance, eval=FALSE, include=FALSE}
source("_src/maintenance.R", local = knitr::knit_global())
```

```{r session start, include=FALSE}
## Load and install packages (using package manager)
if (!require("pacman")) {
  install.packages("pacman")
  library(pacman)
}
pacman::p_load(papaja, knitr, dplyr, remotes, lme4, tidyr, kableExtra,
               modelsummary, performance, stats, lmerTest, ggplot2, corrr,
               parameters, car, psych, jtools, grateful, blockTools,
               robustlmm, usethis, gitcreds, stringr, HLMdiag, lmtest, effects, 
               sjPlot, devtools, rmdwc, fastDummies, crosstable, fuzzyjoin) 

# install.packages("robustlmm", dependencies = TRUE)
# install.packages("broom.mixed", dependencies = TRUE)

```

```{r load files, include=FALSE}
# welcome questionnaire
welcome_raw <- read.csv2("_data/raw/20221018_1718_1_AARL-BS Willkommen.csv")
# activities questionnaire
activities_raw <- read.csv2("_data/raw/20221018_1717_2_AARL-BS Taetigkeiten_de102944944440141306.csv")
# jobscope
jobscope <- read.csv2("_data/jobscope.csv", na = "?")
# jobscope correction
jobscope_correction <- read.csv2("_data/jobscope_v3.csv")
# learning outcome framework
lo_categorization <- read.csv2("_data/lo_categorization.csv")
lo_categorization <- lo_categorization %>%
  select(-pc_learn)

lo_categorization_unique <- lo_categorization %>%
  distinct(, .keep_all = TRUE)

# parent categories for lo_framework
lo_framework <- read.csv2("_archive/framework_learning_outcomes.csv")

lo_framework <- lo_framework %>%
  mutate(across(everything(), tolower))

```

```{r data prep, include=FALSE}
source("_src/data_prep_welcome.R", local = knitr::knit_global())
source("_src/data_prep_activities.R", local = knitr::knit_global())
source("_src/data_prep_manual_qualitative.R", local = knitr::knit_global())

#####
### format all datatypes appropriately! (see previous code (data_prep)) #####
#####
```

```{r prepare combined_df with values from data_prep_qual & format data, include=FALSE}
# import into combined_df from df: task_no, task, sex, age, jobscope, duration
# combined_df$age <- welcome$age[match(combined_df$code, welcome$code)] #####

# update selected values in with values from df (manual data_prep)
# values: age, sex, jobscope, act_no, activity, duration

# Define your list of column names
# list <- c("age", "sex", "jobscope", "act_no", "activity", "duration")
list <- c("age", "sex", "jobscope", "act_no", "activity")
list_code <- c("age", "sex", "jobscope")
list_id <- c("act_no", "activity")

for (value in list_code) {
# Step 1
combined_df[[paste0(value, "_df")]] <- df[[value]][match(combined_df$code, df$code)]
}

for (value in list_id) {
combined_df[[paste0(value, "_df")]] <- df[[value]][match(combined_df$id, df$id)]
}

# Step 2
for (value in list){
  combined_df[[value]] <- ifelse(is.na(combined_df[[paste0(value, "_df")]]) | 
                                   is.na(match(combined_df$code, df$code)), 
    combined_df[[value]],                         
    combined_df[[paste0(value, "_df")]]           
  )
}

# LOGIC #####
# step 1 (simply transfer the values, keep all values from df)
# combined_df$age_df <- df$age[match(combined_df$code, df$code)]
# combined_df$act_no_df <- df$act_no[match(combined_df$id, df$id)]
# combined_df$activity_df <- df$activity[match(combined_df$code, df$id)]

# step 2
# age <- ifelse
# - age_df = NA OR 
# - no match

# then
# = age
# else
# age_df
##################

combined_df <- combined_df %>%
  select(-age_df, -sex_df, -jobscope_df, -act_no_df, -activity_df, -category)

#####
# Adjustments of data (format, corrections, ...)
#####

# remove all other activities (29) reporting illness
# create the dataframe sickness
df_sickness <- df %>%
  filter(krank_ == 1) %>%
  select(id, code, krank_)

combined_df$sickness <- 0
combined_df$sickness <- df_sickness$krank_[match(combined_df$id, df_sickness$id)]

combined_df <- combined_df %>%
  filter(is.na(sickness))

# remove additional reportings of sickness and vacation
# sickness
combined_df <- combined_df %>%
  filter(!(str_detect(activity, "onstige") & 
           (str_detect(activity, "krank") | str_detect(activity, "Krank") | str_detect(activity, "corona") | str_detect(activity, "Corona")) &
           id != 20252 & id != 19836  & id != 48289 & id != 28568 & id != 4759))

# vacation
combined_df <- combined_df %>%
  filter(!(str_detect(activity, "urlaub") | str_detect(activity, "Urlaub")))

# school holidays 
combined_df <- combined_df %>%
  filter(!(str_detect(activity, "ferien") | str_detect(activity, "oster") | str_detect(activity, "Oster")  | str_detect(activity, "Ferien") | str_detect(activity, "schulfrei")))

# weekend
combined_df <- combined_df %>%
  filter(!str_detect(activity, "ochenende"))

# free day
combined_df <- combined_df %>%
  filter(!(str_detect(activity, "frei") | str_detect(activity, "Freien Tag") | str_detect(activity, "eiertag")))

# commuting between home and school
combined_df <- combined_df %>%
  filter(!(str_detect(activity, "rbeitsweg") | str_detect(activity, "hause") | str_detect(activity, "Hause") | str_detect(activity, "zur Schule") | str_detect(activity, "Anreise") | str_detect(activity, "Heim")))


# other invalid entries
combined_df <- combined_df %>%
  filter(!(str_detect(activity, "keine") | str_detect(activity, "Keine") | str_detect(activity, "mQuest") | str_detect(activity, "zeitstudie") | str_detect(activity, ": Hausarbeit") | id == 36469 | id == 49189 | id == 5081 | id == 4356 | id == 5417 | id == 17552))


##########
# correct categories
##########
# some of 29 belong to Aufsicht (9)
combined_df <- combined_df %>% 
  mutate(
    act_no = case_when(
      str_detect(activity, "onstige") & 
      (str_detect(activity, "lausuraufsicht") | str_detect(activity, "rüfungsaufsicht") | str_detect(activity, "ufsicht Klassenarbeit")) ~ 9,
      TRUE ~ act_no  # Behalte den Originalwert bei, wenn keine Bedingung zutrifft
    ),
    activity = case_when(
      str_detect(activity, "onstige") & 
      (str_detect(activity, "lausuraufsicht") | str_detect(activity, "rüfungsaufsicht") | str_detect(activity, "ufsicht Klassenarbeit")) ~ "Aufsicht",
      TRUE ~ activity  # Behalte den Originalwert bei, wenn keine Bedingung zutrifft
    )
  )
# auch Aufsicht: 35883


combined_df <- combined_df %>%
  mutate(act_no = case_when(str_detect(activity, "onstige Tätigkeit") ~ 29, .default = act_no))

combined_df_test <- combined_df %>%
  filter(act_no == 29)

combined_df_test <- combined_df %>%
  filter(act_no == 9)
    
# correct coping
combined_df$coping <- ifelse(combined_df$stress == 0, 0, combined_df$coping)

# format data for analyses
combined_df <- combined_df %>% # Before: 1=w, 2=m; NOW: 0=w, 1=m
  mutate(sex = case_match(sex, 1 ~ 0, 2 ~ 1)
         )

# test
table(combined_df$activity)
table(combined_df$activity [combined_df$act_no == 9])
table(combined_df$activity [combined_df$act_no != 29])
table(combined_df$activity[combined_df$act_no == 20])
table(combined_df$activity[combined_df$act_no == 9])

# compare number of cases (which were deleted?!)

# check other activity (29)
#combined_df_other <- combined_df %>%
#  filter(act_no == 29)


# combined_df <- combined_df %>% # adjust act_no 29
#  mutate(act_no = ifelse(category == 4, 29, act_no))


# insert English activity names



```

# Results

## RQ1: Stress, Coping and Learning during Teachers' Daily Work Activities

-   maybe too similar to bwpat article
-   may cause problems in comparison with bwpat paper (different sample size...)
-   same approach as in bwpat paper: simple comparison of mean values and SDs across the activities
-   29 activities?! --\> decision needed!

```{r filter and prepare data, include=FALSE}
df_rq1 <- combined_df
```

```{r correlations and data checks, include=FALSE}

```

```{r rq1 analysis, include=FALSE}
# make sure coping is given only for stress above 0 and never -1
# something like this...
# df_rq3_coping <- df_rq3 %>%
#  mutate(coping = ifelse(coping < 0, 0, coping))

# act_no 29 does not exist... -> correct!

rq1_stress_coping_learn <- df_rq1 %>%
  group_by(act_no) %>%
  summarise(stress_m = mean(stress), 
            stress_sd = sd(stress), 
            stress_md = median(stress), 
            
            coping_m = mean(coping), 
            coping_sd = sd(coping), 
            coping_md = median(coping), 
            
            learn_m = mean(pc_learn), 
            learn_sd = sd(pc_learn), 
            learn_md = median(pc_learn)
            )
```

```{r, rq1 kable table, echo=FALSE}
rq1_stress_coping_learn %>%
# mutate_if(is.numeric, ~ifelse(is.na(.), " ", format(round(., 2)))) %>%
mutate(across(is.numeric & !act_no, ~ifelse(is.na(.x) , " ", sprintf("%.2f", .x)))) %>%
kable(# digits = c(1,2,2,2,2,2,2,2,2,2)
      , caption = "Descriptive Statistics regarding Stress, Coping and Learning during Teachers' Daily Work Activities", col.names = c("", "M", "SD", "Mdn", "M", "SD", "Mdn", "M", "SD", "Mdn"), align = "lccccccccc") %>%
        add_header_above(c("Activity" = 1, "Stress" = 3, "Coping" = 3, "Learning" = 3)) %>%
  kable_styling(latex_options = c("HOLD_position"), font_size = 9)
```

## RQ2: Description of the Learning During Teachers' Daily Work Activities

```{r, include=FALSE}
df_rq2 <- combined_df # %>%
#  filter(learn_descr != "") # | other_descr != "")
# no filter for learning (all values between 0 and 7)
```

### RQ 2a: Categorization of Outcomes of Vocational Teachers' Daily Work Activities

```{r adding the categorization with fuzzy join (approximative matching), echo=FALSE}
# conduct Fuzzy joint on the cleaned columns
df_rq2_ <- stringdist_join(df_rq2, lo_categorization,
                          by = c("learn_descr" = "learning_outcome"),
                          mode = "left",
                          method = "jw",
                          # Jaro-Winkler for "almost identical" strings
                          max_dist = 0.01) # adjust max. distance value for good results
```

```{r add categories manually, include=FALSE}
# convert learn_descr to lower letters
df_rq2_$learn_descr <- tolower(df_rq2_$learn_descr)
df_rq2_$cat_1 <- tolower(df_rq2_$cat_1)
df_rq2_$cat_2 <- tolower(df_rq2_$cat_2)

df_rq2 <- df_rq2_ %>%
  mutate(cat_1 = ifelse(is.na(cat_1), 
                case_when(
                  # Matches cases with only "keine", "nein", "-", ".", whitespace, or an empty string
                  str_detect(learn_descr, paste0(
                    "^(\\s*-\\s*|",
                    "\\s*—\\s*|",
                    "\\s*\\.\\s*|",
                    "\\s*|",
                    "\\s*das\\s*|",
                    "\\s*ferien\\s*|",
                    "\\s*./.\\s*|",
                    "\\s*jjj\\s*|",
                    "\\s*ä\\s*|",
                    "\\s*ü\\s*|",
                    "\\s*x\\s*|)$"
                    )) ~ "keine angabe",
                  str_detect(learn_descr, paste0(
                    "^(\\s*keine\\s*|",
                    "\\s*nein\\s*|",
                    "\\s*keine.\\s*|",
                    "\\s*kein\\s*|",
                    "\\s*keinr\\s*|",
                    "\\s*kekeine\\s*|",
                    "\\s*0\\s*)$"
                    )) ~ "nichts", 
                  str_detect(learn_descr, paste0(
                  "^(\\s*ja\\s*|",
                    "\\s*s. oben\\s*)$"
                    )) ~ "sonstiges", 
                  TRUE ~ cat_1
                ), cat_1))

# only consider rows with assigned cat_1
df_rq2 <- df_rq2 %>%
  filter(!(is.na(cat_1)))
```

```{r check filtering and which data is included, include=FALSE, eval=FALSE}
# check which values are not matched
df_rq2_test <- df_rq2 %>%
  filter(is.na(cat_1))

# only consider the values that are matched in df_rq2
df_rq2_test <- df_rq2 %>%
  filter(!is.na(cat_1))

# without "keine angabe", "nichts", "other" and is.na
df_rq2_test <- df_rq2 %>%
  filter(!is.na(cat_1)
         & str_detect(cat_1, "keine angabe", negate = TRUE)
         & str_detect(cat_1, "nichts", negate = TRUE) 
         & str_detect(cat_1, "other", negate = TRUE))

# only "keine angabe", "nichts", "other" and is.na
df_rq2_test <- df_rq2 %>%
  filter(!is.na(cat_1) & 
         ( str_detect(cat_1, "keine angabe")
         | str_detect(cat_1, "nichts")))

# df_rq2_ <- df_rq2_
```

```{r import english names, include=FALSE, eval=FALSE}
# later after submission!
```

```{r prepare the data, include=FALSE}
# put the data into the long format
df_long <- df_rq2 %>%
  pivot_longer(cols = c(cat_1, cat_2),
               names_to = "category_type", 
               values_to = "category")

df_long <- df_long %>%
  filter(!is.na(category) & category != "")

# counting the occurrence for every activity and each category
table_rq2a <- df_long %>%
  group_by(act_no, category) %>%
  summarize(count = n(), .groups = 'drop') %>%
  pivot_wider(names_from = category, values_from = count, values_fill = 0)

# sum of the rows (for each activity)
table_rq2a_ <- table_rq2a %>%
  mutate(act_no = as.character(act_no)) %>%
  mutate(sum = rowSums(select(., -act_no)))

# sum of the columns (for each category)
#####

# Calculate column sums for each learning outcome category
column_sums <- colSums(select(table_rq2a_, -act_no, -sum), na.rm = TRUE)

# Create a tibble for the totals row
total_row <- tibble(
  act_no = "Total",
  !!!column_sums  # Using the `!!!` operator to spread the sums into columns
)

# Bind the totals row to the original table
table_rq2a_ <- table_rq2a_ %>%
  bind_rows(total_row)

table_rq2a <- table_rq2a_
rm(table_rq2a_)
rm(table_rq2a_with_totals)
rm(total_row)
```

```{r qr2a1 kable, echo=FALSE}
# table_rq2a but only Total for each category
table_rq2a_total <- table_rq2a %>%
  filter(act_no == "Total")

table_rq2a_total %>%
  kable(
    caption = "Outcomes of Vocational Teachers' Daily Work Activities (RQ2)"
  )

```

```{r rq2a2 kable, echo=FALSE}
# table_rq2a but only Total for each category
table_rq2a_ <- table_rq2a %>%
  filter(act_no == "Total")

# transpose df table_rq2a
table_rq2a_trans <- as.data.frame(t(table_rq2a_))
table_rq2a_trans_ <- table_rq2a_trans %>%
  filter(V1 != "Total", 
         V1 != "sum")
                                  
# import parent category from df_framework
# table_rq2a_test <- table_rq2a %>%
#   mutate(X1 = match(X1, lo_framework_trans$V1))

```


```{r parent_cat}
# Step 1: Join table_rq2a with lo_framework to get parent categories
# We assume the categories in table_rq2a are in a column named `category` (replace it with the actual name).
category_totals <- table_rq2a_ %>%
  filter(act_no == "Total") %>%  # Filter for the total row
  select(-act_no, -sum) %>%  # Remove the 'Total' identifier
  pivot_longer(everything(), names_to = "category", values_to = "total") %>%
  left_join(lo_framework %>% select(X5), by = c("category" = "X5"))  # Join to find parent categories

# Trim whitespace and then perform the match
category_totals$parent_cat <- lo_framework$X1_en[match(trimws(category_totals$category), trimws(lo_framework$X5))]

#####
# Step 2: Aggregate totals by parent category
parent_category_totals <- category_totals %>%
  group_by(parent_cat) %>%
  summarise(total = sum(total, na.rm = TRUE))

# Step 3: Construct the new table with parent categories
new_table <- parent_category_totals %>%
  mutate(act_no = "Total") %>%
  select(act_no, parent_cat, total) %s>%
  pivot_wider(names_from = parent_cat, values_from = total, values_fill = list(total = 0))  # Create the wide format

```

### RQ 2b: Learning Outcomes across Vocational Teachers' Daily Work Activities

```{r}
# only consider learning outcomes specified (no "nothing", no "learning outcome not specified")

# put the data into the long format
df_long <- df_rq2 %>%
  pivot_longer(cols = c(cat_1, cat_2),
               names_to = "category_type", 
               values_to = "category")

df_long <- df_long %>%
  filter(!is.na(category) & category != "")

# counting the occurrence for every activity and each category
table_rq2b <- df_long %>%
  group_by(act_no, category) %>%
  summarize(count = n(), .groups = 'drop') %>%
  pivot_wider(names_from = category, values_from = count, values_fill = 0)

table_rq2b <- table_rq2b %>%
  select(-`keine angabe`, -nichts, -`vermutliche falscheingabe` )

# sum of the rows (for each activity)
table_rq2b_ <- table_rq2b %>%
  mutate(act_no = as.character(act_no)) %>%
  mutate(sum = rowSums(select(., -act_no)))

# sum of the columns (for each category)
#####

# Calculate column sums for each learning outcome category
column_sums <- colSums(select(table_rq2b_, -act_no, -sum), na.rm = TRUE)

# Create a tibble for the totals row
total_row <- tibble(
  act_no = "Total",
  !!!column_sums  # Using the `!!!` operator to spread the sums into columns
)

# Bind the totals row to the original table
table_rq2b_ <- table_rq2b_ %>%
  bind_rows(total_row)

table_rq2b <- table_rq2b_
rm(table_rq2b_)
# rm(table_rq2b_with_totals)
rm(total_row)

```


```{r prepare the data, include=FALSE}
table_rq2b 


```

```{r rq2 kable, echo=FALSE}
table_rq2b %>%
  kable(
    caption = "Learning Categories across Vocational Teachers' Daily Work Activities (RQ2)"
  )
```


## RQ3: Predicting Vocational Teachers' Informal Learning Using Stress and Coping during their Daily Work Activities (as stated in Karasek's Learning Hypothesis)

-   interaction effect

```{r filter data & prepare them, include=FALSE}
df_rq3 <- combined_df
df_rq3$act_no <- as.factor(df_rq3$act_no)

# standardize all variables

# df_rq3$pc_learn_z <- standardize(df_rq3$pc_learn)
df_rq3$stress_z <- standardize(df_rq3$stress)
df_rq3$coping_z <- standardize(df_rq3$coping)


# add dummy variables for act #####
df_rq3 <- dummy_cols(df_rq3, select_columns = "act_no")

```

```{r test all assumptions, include=FALSE}
# multicollinearity?!
# especially with the interaction term ... 
```

```{r correlations, include = FALSE}
# cor_tab <- cor(subset(variant1, select = c(task_routine:proc_learn)))

rq3_subset_cor <- subset(df_rq3, select = c(sex:jobscope, stress:pc_learn, n_entry, stress_z, coping_z))

# maybe add mean and sd

cor_tab_ <- rq3_subset_cor %>%
  # select(c(group_mlm:proc_learn)) %>%
  correlate() %>%
  shave(upper = TRUE) %>%
  fashion(decimals = 2, na_print = "—") 

cor_tab_$term <- paste(seq_len(nrow(cor_tab_)), ". ", cor_tab_$term, sep = "")
```

```{r rq3 corr_table_kable, echo=FALSE}
cor_tab_ %>%
  kable(
    caption = "Correlations between Variables RQ3",
    col.names = c("Measure", "1", "2", "3", "4", "5", "6", "7", "8", "9")
  )
```

```{r rq3 model 1, include=FALSE}
rq3_model1 <- lmerTest::lmer(data = df_rq3, pc_learn ~ 1 + (1|code), REML = T) 

# summary(rq3_model1)
```

```{r rq3 model 1 ICC, echo=FALSE}
# icc calculation
# icc(rq2_model1)
kable(table(round(icc(rq3_model1), 4)), caption = "ICC RQ3 (REML)")
```

```{r rq3 model 1 REML_F, include=FALSE}
rq3_model1 <- lmerTest::lmer(data = df_rq3, pc_learn ~ 1 + (1|code), REML = F) 
```

```{r rq3 model 2, include=FALSE}
# issue: act_no 29 not available

rq3_model2 <- lmerTest::lmer(data = df_rq3, pc_learn ~  sex + age + jobscope + stress_z + coping_z + stress_z*coping_z + n_entry + 
                               act_no_1 +  act_no_2 + 
                               act_no_3 +  act_no_4 +
                               act_no_5 +  act_no_6 + 
                               act_no_7 +  act_no_8 + 
                               act_no_9 +  act_no_10 + 
                               act_no_11 + act_no_12 + 
                               act_no_13 + act_no_14 + 
                               act_no_15 + act_no_16 + 
                               act_no_17 + act_no_18 + 
                               act_no_19 + act_no_20 +
                               act_no_21 + act_no_22 +
                               act_no_23 + act_no_24 +
                               act_no_25 + act_no_26 +
                               act_no_27 + act_no_28 + #act_no_29 + 
                               (1|code), REML = F) # + time + activity dummy variables

summary(rq3_model2)
```

```{r rq3 results table, echo=FALSE}
rq3_results_table <- modelsummary::msummary(list("Model 1" = rq3_model1, 
                                                 "Model 2" = rq3_model2), gof_omit = "ICC", stars = T, title = "Summary Multilevel Model RQ3", output = 'kableExtra', metrics = "all", statistic = c("std.error", "p.value", "conf.int"))

rq3_results_table %>%
  kableExtra::kable_styling(latex_options = "HOLD_position")
```

```{r rq3 kable, echo=FALSE}
# kable(rq3_model2, digits = 2, caption = "MLM of Informal Learning during Teachers' Work Activities ")
```

# Conclusion

\newpage

# Data availability statement

The anonymized data are available on Mendeley Data (<https://www.elsevier.com/researcher/author/tools-and-resources/research-data>) under the following link: ...\

# References

::: {#refs custom-style="Bibliography"}
:::

\newpage

# Appendix

## Possible Journals {.unnumbered}

Teaching and Teacher Education (IF: 4.0),\
[https://doi.org/10.1016/S0742-051X(02)00101-4](https://doi.org/10.1016/S0742-051X(02)00101-4 "Persistent link using digital object identifier") was also published here

Regelungen/Hinweise:

-   Abstract: 100 words, 3 - 6 keywords

-   Report: 5.000-9.000 words

Ansonsten:

-   Human Resource Development International (IF: 3.8)

    -   <https://doi.org/10.1080/13678860010004123> was also published here

-   Journal of Workplace Learning (IF: )

-   Vocations and Learning (IF: 1.9)

-   Learning Environments Research (IF: 2.7)

-   Technology, Knowledge and Learning (IF: 3.0) - not that fitting...

-   Empirical Research in Vocational Education and Training (IF: 1.6)

-   Learning and Instruction (IF: 4.7) - not that fitting...
